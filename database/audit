USE chagee_db;
GO

-- Bảng lưu lịch sử thay đổi sản phẩm (Insert/Update)
IF OBJECT_ID('ProductAudits', 'U') IS NOT NULL DROP TABLE ProductAudits;
CREATE TABLE ProductAudits (
    audit_id INT IDENTITY(1,1) PRIMARY KEY,
    product_id VARCHAR(50),
    action_type VARCHAR(20), -- 'INSERT', 'UPDATE'
    changed_by NVARCHAR(100) DEFAULT SYSTEM_USER,
    changed_time DATETIME DEFAULT GETDATE(),
    
    -- Dữ liệu cũ
    old_product_name NVARCHAR(100),
    old_price DECIMAL(18, 2),
    
    -- Dữ liệu mới
    new_product_name NVARCHAR(100),
    new_price DECIMAL(18, 2),
    
    reason NVARCHAR(255)
);
GO

-- Bảng lưu lịch sử xóa sản phẩm (Delete)
IF OBJECT_ID('ProductDeleteAudits', 'U') IS NOT NULL DROP TABLE ProductDeleteAudits;
CREATE TABLE ProductDeleteAudits (
    audit_id INT IDENTITY(1,1) PRIMARY KEY,
    product_id VARCHAR(50),
    deleted_by NVARCHAR(100) DEFAULT SYSTEM_USER,
    deleted_time DATETIME DEFAULT GETDATE(),
    
    product_name NVARCHAR(100),
    price DECIMAL(18, 2),
    sold_quantity INT
);
GO